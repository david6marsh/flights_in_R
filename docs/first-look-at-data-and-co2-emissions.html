<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 First look at data and CO2 Emissions | Analysing Flights with R</title>
  <meta name="description" content="This is a training and reference manual for Eurocontrol staff, on how to use RStudio to analyse our traffic data." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 First look at data and CO2 Emissions | Analysing Flights with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a training and reference manual for Eurocontrol staff, on how to use RStudio to analyse our traffic data." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 First look at data and CO2 Emissions | Analysing Flights with R" />
  
  <meta name="twitter:description" content="This is a training and reference manual for Eurocontrol staff, on how to use RStudio to analyse our traffic data." />
  

<meta name="author" content="David Marsh" />


<meta name="date" content="2021-01-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="start.html"/>
<link rel="next" href="filtering-a-dataset-and-refining-the-co2-graph.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Analysing Flights in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> How to use this book</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#before-you-start"><i class="fa fa-check"></i><b>1.1</b> Before you start</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#ways-to-use-the-material"><i class="fa fa-check"></i><b>1.2</b> Ways to Use the Material</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#whats-gone-wrong"><i class="fa fa-check"></i><b>1.3</b> What’s gone wrong?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="start.html"><a href="start.html"><i class="fa fa-check"></i><b>2</b> Getting started</a>
<ul>
<li class="chapter" data-level="2.1" data-path="start.html"><a href="start.html#rstudio"><i class="fa fa-check"></i><b>2.1</b> Orientation in RStudio</a></li>
<li class="chapter" data-level="2.2" data-path="start.html"><a href="start.html#first-project"><i class="fa fa-check"></i><b>2.2</b> First project</a></li>
<li class="chapter" data-level="2.3" data-path="start.html"><a href="start.html#first-code"><i class="fa fa-check"></i><b>2.3</b> First code</a></li>
<li class="chapter" data-level="2.4" data-path="start.html"><a href="start.html#packages"><i class="fa fa-check"></i><b>2.4</b> First packages</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="start.html"><a href="start.html#package-basics"><i class="fa fa-check"></i><b>2.4.1</b> Package basics</a></li>
<li class="chapter" data-level="2.4.2" data-path="start.html"><a href="start.html#tidyverse"><i class="fa fa-check"></i><b>2.4.2</b> Tidyverse</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="start.html"><a href="start.html#filetypes"><i class="fa fa-check"></i><b>2.5</b> File types</a></li>
<li class="chapter" data-level="2.6" data-path="start.html"><a href="start.html#whats-gone-wrong-1"><i class="fa fa-check"></i><b>2.6</b> What’s gone wrong?</a></li>
<li class="chapter" data-level="2.7" data-path="start.html"><a href="start.html#test-yourself"><i class="fa fa-check"></i><b>2.7</b> Test yourself</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="start.html"><a href="start.html#questions"><i class="fa fa-check"></i><b>2.7.1</b> Questions</a></li>
<li class="chapter" data-level="2.7.2" data-path="start.html"><a href="start.html#answers"><i class="fa fa-check"></i><b>2.7.2</b> Answers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html"><i class="fa fa-check"></i><b>3</b> First look at data and CO<sub>2</sub> Emissions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#loadco2"><i class="fa fa-check"></i><b>3.1</b> Looking at data: CO<sub>2</sub> Data</a></li>
<li class="chapter" data-level="3.2" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#extracting-variables"><i class="fa fa-check"></i><b>3.2</b> Extracting variables</a></li>
<li class="chapter" data-level="3.3" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#extracting-a-few-values"><i class="fa fa-check"></i><b>3.3</b> Extracting a few values</a></li>
<li class="chapter" data-level="3.4" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#co2-scatter-plot"><i class="fa fa-check"></i><b>3.4</b> CO<sub>2</sub> Scatter plot</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#first-draft"><i class="fa fa-check"></i><b>3.4.1</b> First draft</a></li>
<li class="chapter" data-level="3.4.2" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#improve-the-titles"><i class="fa fa-check"></i><b>3.4.2</b> Improve the titles</a></li>
<li class="chapter" data-level="3.4.3" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#statecluster"><i class="fa fa-check"></i><b>3.4.3</b> and with clustering by State</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#whats-gone-wrong-2"><i class="fa fa-check"></i><b>3.5</b> What’s gone wrong?</a></li>
<li class="chapter" data-level="3.6" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#test-yourself-1"><i class="fa fa-check"></i><b>3.6</b> Test yourself</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#questions-1"><i class="fa fa-check"></i><b>3.6.1</b> Questions</a></li>
<li class="chapter" data-level="3.6.2" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#answers-1"><i class="fa fa-check"></i><b>3.6.2</b> Answers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html"><i class="fa fa-check"></i><b>4</b> Filtering a dataset and refining the CO<sub>2</sub> graph</a>
<ul>
<li class="chapter" data-level="4.1" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#sequences-of-functions"><i class="fa fa-check"></i><b>4.1</b> Sequences of functions</a></li>
<li class="chapter" data-level="4.2" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#filtering-datasets-and-logical-tests"><i class="fa fa-check"></i><b>4.2</b> Filtering datasets and Logical Tests</a></li>
<li class="chapter" data-level="4.3" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#selecting-the-busiest-states"><i class="fa fa-check"></i><b>4.3</b> Selecting the busiest States</a></li>
<li class="chapter" data-level="4.4" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#co2-graph-for-the-top-states"><i class="fa fa-check"></i><b>4.4</b> CO<sub>2</sub> graph for the top States</a></li>
<li class="chapter" data-level="4.5" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#labelling-the-co2-graph"><i class="fa fa-check"></i><b>4.5</b> Labelling the CO<sub>2</sub> graph</a></li>
<li class="chapter" data-level="4.6" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#what-does-the-graph-say-about-co2"><i class="fa fa-check"></i><b>4.6</b> What does the graph say about CO<sub>2</sub>?</a></li>
<li class="chapter" data-level="4.7" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#whats-gone-wrong-3"><i class="fa fa-check"></i><b>4.7</b> What’s gone wrong?</a></li>
<li class="chapter" data-level="4.8" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#exercises"><i class="fa fa-check"></i><b>4.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#questions-2"><i class="fa fa-check"></i><b>4.8.1</b> Questions</a></li>
<li class="chapter" data-level="4.8.2" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#answers-2"><i class="fa fa-check"></i><b>4.8.2</b> Answers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Analysing Flights with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="first-look-at-data-and-co2-emissions" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> First look at data and CO<sub>2</sub> Emissions</h1>
<p>It’s hard to get far in an analysis without first looking at the data to ask questions such as:</p>
<ul>
<li>What variables are there? Do I know what they all mean?</li>
<li>What time period does it cover?</li>
<li>Which countries, or airports etc, are included?</li>
</ul>
<p>In this chapter, we introduce some of the ways to take a quick look at your data. We introduce some data on CO<sub>2</sub> emissions per European State from aviation.</p>
<table>
<colgroup>
<col width="100%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">In this chapter</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>read_xlsx()</code>, <code>&lt;-</code>, <code>summary</code>, <code>str</code>, environment pane, <code>View()</code>, <code>unique</code>, <code>head</code>, <code>c()</code>, <code>[]</code>, <code>ggplot()</code></td>
</tr>
</tbody>
</table>
<p>Re-open your <code>justlearning</code> project and start a new source file, to copy and paste the examples into. This starts a new R session, which means you have to re-load the package(s) that you need.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="first-look-at-data-and-co2-emissions.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(tidyverse)) <span class="co"># without lots of messages filling up the book</span></span></code></pre></div>
<div id="loadco2" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Looking at data: CO<sub>2</sub> Data</h2>
<p>We use public data on national CO<sub>2</sub> emissions from aviation available on the <a href="https://ansperformance.eu/data/">EUROCONTROL/AIU website</a>. We choose this, apart from the interest in the data themselves, because it’s a small set so quick to download, and it’s already tidy (each variable in one column).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="first-look-at-data-and-co2-emissions.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download the file to the data folder</span></span>
<span id="cb6-2"><a href="first-look-at-data-and-co2-emissions.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># download.file(&quot;https://ansperformance.eu/download/xls/CO2_emissions_by_state.xlsx&quot;, </span></span>
<span id="cb6-3"><a href="first-look-at-data-and-co2-emissions.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#               &quot;data/CO2_emissions_by_state.xlsx&quot;)</span></span>
<span id="cb6-4"><a href="first-look-at-data-and-co2-emissions.html#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="first-look-at-data-and-co2-emissions.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># load from the DATA worksheet - case sensitive!</span></span>
<span id="cb6-6"><a href="first-look-at-data-and-co2-emissions.html#cb6-6" aria-hidden="true" tabindex="-1"></a>aviation_co2 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&quot;data/CO2_emissions_by_state.xlsx&quot;</span>, </span>
<span id="cb6-7"><a href="first-look-at-data-and-co2-emissions.html#cb6-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sheet =</span> <span class="st">&quot;DATA&quot;</span>)</span></code></pre></div>
<p>We’ve already seen the <code>function(parameter)</code> way to call a function in the <code>cos(pi/3)</code> example. Now we have <code>something &lt;- function(parameter, parameter)</code>. This is a peculiarity of R that you just need to get used to. Think of it as saying: create <code>something</code> in the environment (without saying what it is just yet); then fill it (<code>&lt;-</code>) with; the results of the <code>function</code>.</p>
<p>Now that the Excel is downloaded, comment out the 2 lines, because we don’t need to keep downloading if you happen to re-run the code. If there were frequent updates, maybe you would keep downloading. See (TBD) for an example. See the Excel, now in your project <code>data</code> folder, for disclaimer and details.</p>
<p>International conventions mean that CO<sub>2</sub> emissions are measured from flights departing airports in a State. <code>read_xlsx</code> automatically selects the first row as variable names.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="first-look-at-data-and-co2-emissions.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(aviation_co2)</span></code></pre></div>
<pre><code>##       YEAR       STATE_NAME         STATE_CODE        Y_CO2_QTY_TONNES        Y_TF        
##  Min.   :2010   Length:432         Length:432         Min.   :       1   Min.   :      2  
##  1st Qu.:2012   Class :character   Class :character   1st Qu.:  196430   1st Qu.:  16603  
##  Median :2015   Mode  :character   Mode  :character   Median : 1042641   Median :  56292  
##  Mean   :2015                                         Mean   : 4223363   Mean   : 205720  
##  3rd Qu.:2017                                         3rd Qu.: 3308375   3rd Qu.: 225938  
##  Max.   :2019                                         Max.   :37260380   Max.   :1265392</code></pre>
<p>The <code>summary</code> function is fairly basic, but it gives a quick feel for what’s in the data. Often more helpful with numeric than character, but also useful for spotting if there are missing values <code>NA</code>, of which there are none here.</p>
<p>In this dataset we have:</p>
<ul>
<li>YEAR: An integer, not a date, but read_xlsx reads this as a real number.</li>
<li>STATE_NAME, STATE_CODE: A long name and the 2-letter ‘country code’ derived from the ICAO 4-letter communication address, of which the less said, the better.</li>
<li>Y_CO2_QTY_TONNES: Total annual CO2 emissions, in (metric) tonnes.</li>
<li>Y_TF: Total flights. Presumably this is departing flights (TBD)</li>
</ul>
<p>There are three other important ways to explore the data. Firstly in the environment pane (top right, CTRL-8), where you can click the blue arrow-disk to see a summary. You get much the same thing in the console by typing <code>str(aviation_co2)</code> where <code>str</code> is for ‘structure.’ You should see something like this.</p>
<p><img src="images/CO2InEnvironment.png" /></p>
<p>We can see that there are 3 numeric variables (<code>num</code>) and 3 character variables (<code>chr</code>). All 5 variables have the same number of observations (432 - but maybe this is more by the time you download it). In a tibble or data.frame the columns are always the same length.</p>
<p>The second way, because this is a tibble, is just to type its name in the console. [Try it] This is useful but just bear in mind that for some data structures, this might fill up your console with a lot of output. Save it for when you’re sure you’ve a tibble. You can check by typing <code>class(my_thing)</code> into the console to see if <code>my_thing</code> is a tibble (shown as <code>tbl</code>).</p>
<p>The third way gives a way to explore every observation. Click on the dataset name next to the blue arrow or type <code>View(aviation_co2)</code> in the console (sorry about the upper case ‘V’) and you get a tabular data explorer, which allows you to sort and filter. You should see something like this. Try out the sorting and filtering in the view window.</p>
<p><img src="images/CO2inViewAndEnvironment.png" /></p>
</div>
<div id="extracting-variables" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Extracting variables</h2>
<p>To answer more questions about the data there are some more tools to summarise the values that it takes. We saw <code>summary()</code> works for numeric values, but what about discrete ones?</p>
<p>There are several ways to pull one variable out of your data. We’ll use the <code>$</code> notation, partly because there’s a reminder of this in the environment tab.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="first-look-at-data-and-co2-emissions.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pull out all values in the column</span></span>
<span id="cb9-2"><a href="first-look-at-data-and-co2-emissions.html#cb9-2" aria-hidden="true" tabindex="-1"></a>state_vbl <span class="ot">&lt;-</span> aviation_co2<span class="sc">$</span>STATE_NAME</span>
<span id="cb9-3"><a href="first-look-at-data-and-co2-emissions.html#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="first-look-at-data-and-co2-emissions.html#cb9-4" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">unique</span>(state_vbl)</span></code></pre></div>
<p>Look in the environment pane, <code>state_vbl</code> is listed under ‘Values.’ It’s a (column) vector, one of the simple data types in R which is why it’s listed under ‘Values’ and not under ‘Data.’ You’ve just pulled a column out of <code>aviation_co2</code> so not surprising that it has the same number of rows as <code>aviation_co2</code>. And the first values are all ALBANIA, or were when this book was compiled.</p>
<p>Really we want to know how many different States there are, and which ones. <code>unique</code> does what it says, and we’ve saved these as <code>states</code>; a variable name which to me implies ‘unique States.’ You can tell how many there are from the environment pane, or you could use <code>length(states)</code>. [How many are there?]</p>
<p>To inspect all of these values you can just type <code>states</code> into the console, a good way to check the spelling of some, perhaps. [Try this.]</p>
<p>The order in which the elements are shown is as in the original data, there’s no careless re-ordering. If you’ve worked with SAS PROC SQL or other languages, it might come as a relief to hear that, in R, the order of rows stays where it’s put until you say otherwise; none of this sorting before every operation. We’ll see some ways to handle ‘top’ values later (TBD - top_n)</p>
<p>So in this case, even if the <code>states</code> are in alphabetical order, that’s just because the original Excel file was.</p>
</div>
<div id="extracting-a-few-values" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Extracting a few values</h2>
<p>We’ve just seen how to pull a variable out of a tibble. How do we extract one or more values out of the vector that we created?</p>
<p>The <code>states</code> are quite a lot to show in the console. If you had even more you might just want to see a few. The code chunk above shows that <code>head()</code> is useful for showing you the first ones (6 by default).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="first-look-at-data-and-co2-emissions.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(states)</span></code></pre></div>
<pre><code>## [1] &quot;ALBANIA&quot;                &quot;ARMENIA&quot;                &quot;AUSTRIA&quot;               
## [4] &quot;BELGIUM&quot;                &quot;BOSNIA AND HERZEGOVINA&quot; &quot;BULGARIA&quot;</code></pre>
<p>If you want to pull out a single value, or a few of them, again there are multiple ways to do this, but the simplest is this. We show here two ways to select with a vector of numbers: creating a consecutive sequence of numbers (<code>1:3</code>); and creating a vector with an arbitrary selection (<code>c(1, 5, 10)</code>).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="first-look-at-data-and-co2-emissions.html#cb12-1" aria-hidden="true" tabindex="-1"></a>states[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] &quot;ALBANIA&quot;</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="first-look-at-data-and-co2-emissions.html#cb14-1" aria-hidden="true" tabindex="-1"></a>states[<span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] &quot;AUSTRIA&quot;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="first-look-at-data-and-co2-emissions.html#cb16-1" aria-hidden="true" tabindex="-1"></a>states[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] &quot;ALBANIA&quot; &quot;ARMENIA&quot; &quot;AUSTRIA&quot;</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="first-look-at-data-and-co2-emissions.html#cb18-1" aria-hidden="true" tabindex="-1"></a>states[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>)]</span></code></pre></div>
<pre><code>## [1] &quot;ALBANIA&quot;                &quot;BOSNIA AND HERZEGOVINA&quot; &quot;CZECHIA&quot;</code></pre>
<p>We’ll deal with subsetting the whole dataset, rather than just a vector, in the next chapter.</p>
</div>
<div id="co2-scatter-plot" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> CO<sub>2</sub> Scatter plot</h2>
<p>It’s hard to beat a graph as a way to explore data. So we end the chapter exploring a simple graph.</p>
<p>The tidyverse way of doing this is to use <code>ggplot</code>.</p>
<div id="first-draft" class="section level3" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> First draft</h3>
<p>In the most basic scatter plot we have the following components, joined with a <code>+</code>. This <code>+</code> is peculiar to <code>ggplot</code>; another lovable quirk of R. Learn it, but get used to the idea that you’ll forget and use other conjunctions by mistake at times.</p>
<p>In the simplest code we have:</p>
<ul>
<li><code>ggplot</code>: with parameters the data to use, and an ‘aesthetic’ <code>aes</code>;</li>
<li><code>aes</code>: gives the x and y first, and here also says choose colour based on year;</li>
<li><code>geom_point</code>: says to plot points with these data, ie a scatter plot.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="first-look-at-data-and-co2-emissions.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(aviation_co2, </span>
<span id="cb20-2"><a href="first-look-at-data-and-co2-emissions.html#cb20-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(Y_TF, Y_CO2_QTY_TONNES, <span class="at">colour =</span> YEAR)) <span class="sc">+</span></span>
<span id="cb20-3"><a href="first-look-at-data-and-co2-emissions.html#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span></code></pre></div>
<p><img src="flights_in_R_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Even this simple example illustrates that:</p>
<ul>
<li>a parameter can be another function call <code>aes()</code>;</li>
<li>we can specify parameters by order of appearance (<code>x</code> and <code>y</code> are first and second for <code>aes</code>) or by name (<code>colour</code>), or both;</li>
<li><code>geom_point</code> takes its aesthetics by default from the <code>ggplot</code> statement.</li>
</ul>
<p>There’s a (very) rough correlation along a diagonal line, but it would be interesting to know which States are above the line (more CO<sub>2</sub> per flight) and which below. And is the change gradual, or is there much variability?</p>
</div>
<div id="improve-the-titles" class="section level3" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Improve the titles</h3>
<p>Let’s at least label the axes so that someone else can see quickly what has been plotted. We can transform variables on the fly (using the rule that a parameter can be a function call, here to the function <code>/</code>), so let’s convert both axes to millions.</p>
<p>The label on the legend is meaningful, but to avoid the block capitals we can change that too within the <code>labs</code> statement.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="first-look-at-data-and-co2-emissions.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(aviation_co2, <span class="fu">aes</span>(Y_TF<span class="sc">/</span><span class="fl">1e6</span>, Y_CO2_QTY_TONNES<span class="sc">/</span><span class="fl">1e6</span>, <span class="at">colour =</span> YEAR)) <span class="sc">+</span></span>
<span id="cb21-2"><a href="first-look-at-data-and-co2-emissions.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb21-3"><a href="first-look-at-data-and-co2-emissions.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Departing Flights (millions)&quot;</span>, </span>
<span id="cb21-4"><a href="first-look-at-data-and-co2-emissions.html#cb21-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;CO2 (million tonnes)&quot;</span>,</span>
<span id="cb21-5"><a href="first-look-at-data-and-co2-emissions.html#cb21-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb21-6"><a href="first-look-at-data-and-co2-emissions.html#cb21-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Emissions per State&quot;</span>)</span></code></pre></div>
<p><img src="flights_in_R_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="statecluster" class="section level3" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> and with clustering by State</h3>
<p>It’s tempting to read the graph as having a number of small clusters, each with flights and CO<sub>2</sub> increasing with time, and assume that each of these corresponds to a single State. It would be nice to use the graph to see if that’s true.</p>
<p>There are too many countries to give each its own shape (we’ll see shapes used more effectively in TBD), but we can easily add a line to join the points for each State. [How do you think you would add a line?]</p>
<p>We need both to add a line, which follows the pattern of <code>geom_point</code>, and group by State. That’s done in the same way that we coloured by year, in the aesthetics. But there are several ways to plot a line <code>geom_line</code> joins the points in x-axis order, we want data order, so that’s <code>geom_path</code>.</p>
<p>Out of a sense of neatness, we also add a subscript to CO<sub>2</sub>. The code <code>bquote(~CO[2]~" (million tonnes)")</code> took some googling and is cryptic, but it works!</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="first-look-at-data-and-co2-emissions.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(aviation_co2, <span class="fu">aes</span>(Y_TF<span class="sc">/</span><span class="fl">1e6</span>, Y_CO2_QTY_TONNES<span class="sc">/</span><span class="fl">1e6</span>, </span>
<span id="cb22-2"><a href="first-look-at-data-and-co2-emissions.html#cb22-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">colour =</span> YEAR, <span class="at">group =</span> STATE_NAME)) <span class="sc">+</span></span>
<span id="cb22-3"><a href="first-look-at-data-and-co2-emissions.html#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb22-4"><a href="first-look-at-data-and-co2-emissions.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>() <span class="sc">+</span></span>
<span id="cb22-5"><a href="first-look-at-data-and-co2-emissions.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Departing Flights (millions)&quot;</span>, </span>
<span id="cb22-6"><a href="first-look-at-data-and-co2-emissions.html#cb22-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">bquote</span>(<span class="sc">~</span>CO[<span class="dv">2</span>]<span class="sc">~</span><span class="st">&quot; (million tonnes)&quot;</span>),</span>
<span id="cb22-7"><a href="first-look-at-data-and-co2-emissions.html#cb22-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb22-8"><a href="first-look-at-data-and-co2-emissions.html#cb22-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Emissions per State&quot;</span>)</span></code></pre></div>
<p><img src="flights_in_R_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>The graph isn’t ready for a presentation yet, but a story is already emerging. The lines do the job of grouping the years for each State together. We see a graph with 6 busy States, 3 of which are fairly linear, so a relatively fixed CO<sub>2</sub>/flight. Three others are more variable from year to year.</p>
<p>Then there are two States, with flights in the 0.25-0.5 million flights range and that diverge from the main trend line. The remaining States rather overlap in this graph.</p>
<p>We’ll find out how to pick out and label States in the next chapter.</p>
</div>
</div>
<div id="whats-gone-wrong-2" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> What’s gone wrong?</h2>
</div>
<div id="test-yourself-1" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Test yourself</h2>
<div id="questions-1" class="section level3" number="3.6.1">
<h3><span class="header-section-number">3.6.1</span> Questions</h3>
<ol style="list-style-type: decimal">
<li>Use <code>head</code> to view the first 10 states.</li>
<li>Using the help file for <code>head</code>, how would you display the last 6 states?</li>
<li>Which State names are followed by ’*’?</li>
<li>Print the distinct state ISO codes to the console.</li>
<li>Print the 3rd, 23rd and 33rd state names to the console.</li>
<li>What does <code>&lt;-</code> do?</li>
<li>In <code>ggplot</code> what does <code>+</code> do?</li>
</ol>
</div>
<div id="answers-1" class="section level3" number="3.6.2">
<h3><span class="header-section-number">3.6.2</span> Answers</h3>
<ol style="list-style-type: decimal">
<li><code>head(states, 10)</code></li>
<li><code>head</code> is documented alongside <code>tail</code>: use <code>tail(states)</code></li>
<li>(In my version of the data), typing <code>states</code> into the console, and by eye I see 4 States with a ’*’. We’ll see other ways to do this, later.</li>
<li><code>unique(aviation_co2$STATE_CODE)</code></li>
<li><code>states[c(3, 23, 33)]</code></li>
<li>It puts the results of whatever is on the right-hand side into the object on the left.</li>
<li>It connects parts of the definition of a graph together.</li>
</ol>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="start.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="filtering-a-dataset-and-refining-the-co2-graph.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["flights_in_R.pdf", "flights_in_R.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
