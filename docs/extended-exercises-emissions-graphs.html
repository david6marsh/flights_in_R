<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Extended Exercises - Emissions Graphs | Analysing Flights with R - UNDER CONSTRUCTION</title>
  <meta name="description" content="This is a training and reference manual for Eurocontrol staff, on how to use RStudio to analyse our traffic data. - UNDER CONSTRUCTION -" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Extended Exercises - Emissions Graphs | Analysing Flights with R - UNDER CONSTRUCTION" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a training and reference manual for Eurocontrol staff, on how to use RStudio to analyse our traffic data. - UNDER CONSTRUCTION -" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Extended Exercises - Emissions Graphs | Analysing Flights with R - UNDER CONSTRUCTION" />
  
  <meta name="twitter:description" content="This is a training and reference manual for Eurocontrol staff, on how to use RStudio to analyse our traffic data. - UNDER CONSTRUCTION -" />
  

<meta name="author" content="David Marsh" />


<meta name="date" content="2021-03-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sortbars.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Analysing Flights in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> How to use this book</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#before-you-start"><i class="fa fa-check"></i><b>1.1</b> Before you start</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#ways-to-use-the-material"><i class="fa fa-check"></i><b>1.2</b> Ways to Use the Material</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#structure-of-the-book"><i class="fa fa-check"></i><b>1.3</b> Structure of the book</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#whats-gone-wrong"><i class="fa fa-check"></i><b>1.4</b> What’s gone wrong?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="start.html"><a href="start.html"><i class="fa fa-check"></i><b>2</b> Getting started</a>
<ul>
<li class="chapter" data-level="2.1" data-path="start.html"><a href="start.html#rstudio"><i class="fa fa-check"></i><b>2.1</b> Orientation in RStudio</a></li>
<li class="chapter" data-level="2.2" data-path="start.html"><a href="start.html#first-project"><i class="fa fa-check"></i><b>2.2</b> First project</a></li>
<li class="chapter" data-level="2.3" data-path="start.html"><a href="start.html#first-code"><i class="fa fa-check"></i><b>2.3</b> First code</a></li>
<li class="chapter" data-level="2.4" data-path="start.html"><a href="start.html#packages"><i class="fa fa-check"></i><b>2.4</b> First packages</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="start.html"><a href="start.html#twocolons"><i class="fa fa-check"></i><b>2.4.1</b> Package basics</a></li>
<li class="chapter" data-level="2.4.2" data-path="start.html"><a href="start.html#tidyverse"><i class="fa fa-check"></i><b>2.4.2</b> Tidyverse</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="start.html"><a href="start.html#filetypes"><i class="fa fa-check"></i><b>2.5</b> File types</a></li>
<li class="chapter" data-level="2.6" data-path="start.html"><a href="start.html#whats-gone-wrong-1"><i class="fa fa-check"></i><b>2.6</b> What’s gone wrong?</a></li>
<li class="chapter" data-level="2.7" data-path="start.html"><a href="start.html#test-yourself"><i class="fa fa-check"></i><b>2.7</b> Test yourself</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="start.html"><a href="start.html#questions"><i class="fa fa-check"></i><b>2.7.1</b> Questions</a></li>
<li class="chapter" data-level="2.7.2" data-path="start.html"><a href="start.html#answers"><i class="fa fa-check"></i><b>2.7.2</b> Answers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="firstLook.html"><a href="firstLook.html"><i class="fa fa-check"></i><b>3</b> First look at data and CO<sub>2</sub> emissions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="firstLook.html"><a href="firstLook.html#loadco2"><i class="fa fa-check"></i><b>3.1</b> Looking at data: CO<sub>2</sub> Data</a></li>
<li class="chapter" data-level="3.2" data-path="firstLook.html"><a href="firstLook.html#extracting-variables"><i class="fa fa-check"></i><b>3.2</b> Extracting variables</a></li>
<li class="chapter" data-level="3.3" data-path="firstLook.html"><a href="firstLook.html#someValues"><i class="fa fa-check"></i><b>3.3</b> Extracting a few values</a></li>
<li class="chapter" data-level="3.4" data-path="firstLook.html"><a href="firstLook.html#co2-scatter-plot"><i class="fa fa-check"></i><b>3.4</b> CO<sub>2</sub> Scatter plot</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="firstLook.html"><a href="firstLook.html#first-draft"><i class="fa fa-check"></i><b>3.4.1</b> First draft</a></li>
<li class="chapter" data-level="3.4.2" data-path="firstLook.html"><a href="firstLook.html#improve-the-titles"><i class="fa fa-check"></i><b>3.4.2</b> Improve the titles</a></li>
<li class="chapter" data-level="3.4.3" data-path="firstLook.html"><a href="firstLook.html#statecluster"><i class="fa fa-check"></i><b>3.4.3</b> and with clustering by state</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="firstLook.html"><a href="firstLook.html#whats-gone-wrong-2"><i class="fa fa-check"></i><b>3.5</b> What’s gone wrong?</a></li>
<li class="chapter" data-level="3.6" data-path="firstLook.html"><a href="firstLook.html#test-yourself-1"><i class="fa fa-check"></i><b>3.6</b> Test yourself</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="firstLook.html"><a href="firstLook.html#questions-1"><i class="fa fa-check"></i><b>3.6.1</b> Questions</a></li>
<li class="chapter" data-level="3.6.2" data-path="firstLook.html"><a href="firstLook.html#answers-1"><i class="fa fa-check"></i><b>3.6.2</b> Answers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="filter.html"><a href="filter.html"><i class="fa fa-check"></i><b>4</b> Filtering a dataset and refining the CO<sub>2</sub> graph</a>
<ul>
<li class="chapter" data-level="4.1" data-path="filter.html"><a href="filter.html#sequences-of-functions"><i class="fa fa-check"></i><b>4.1</b> Sequences of functions</a></li>
<li class="chapter" data-level="4.2" data-path="filter.html"><a href="filter.html#filtering-datasets-and-logical-tests"><i class="fa fa-check"></i><b>4.2</b> Filtering datasets and logical tests</a></li>
<li class="chapter" data-level="4.3" data-path="filter.html"><a href="filter.html#topStates"><i class="fa fa-check"></i><b>4.3</b> Selecting the busiest states</a></li>
<li class="chapter" data-level="4.4" data-path="filter.html"><a href="filter.html#co2-graph-for-the-top-states"><i class="fa fa-check"></i><b>4.4</b> CO<sub>2</sub> graph for the top states</a></li>
<li class="chapter" data-level="4.5" data-path="filter.html"><a href="filter.html#labelco2"><i class="fa fa-check"></i><b>4.5</b> Labelling the CO<sub>2</sub> graph</a></li>
<li class="chapter" data-level="4.6" data-path="filter.html"><a href="filter.html#what-does-the-graph-say-about-co2"><i class="fa fa-check"></i><b>4.6</b> What does the graph say about CO<sub>2</sub>?</a></li>
<li class="chapter" data-level="4.7" data-path="filter.html"><a href="filter.html#whats-gone-wrong-3"><i class="fa fa-check"></i><b>4.7</b> What’s gone wrong?</a></li>
<li class="chapter" data-level="4.8" data-path="filter.html"><a href="filter.html#exercises"><i class="fa fa-check"></i><b>4.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="filter.html"><a href="filter.html#questions-2"><i class="fa fa-check"></i><b>4.8.1</b> Questions</a></li>
<li class="chapter" data-level="4.8.2" data-path="filter.html"><a href="filter.html#answers-2"><i class="fa fa-check"></i><b>4.8.2</b> Answers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sortbars.html"><a href="sortbars.html"><i class="fa fa-check"></i><b>5</b> Sorting Bars, Saving Graphs, Facets</a>
<ul>
<li class="chapter" data-level="5.1" data-path="sortbars.html"><a href="sortbars.html#firstsortedbar"><i class="fa fa-check"></i><b>5.1</b> The simple sorted bar chart - more on CO<sub>2</sub></a></li>
<li class="chapter" data-level="5.2" data-path="sortbars.html"><a href="sortbars.html#saving-a-plot"><i class="fa fa-check"></i><b>5.2</b> Saving a plot</a></li>
<li class="chapter" data-level="5.3" data-path="sortbars.html"><a href="sortbars.html#plotting-more-than-one-year"><i class="fa fa-check"></i><b>5.3</b> Plotting more than one year</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="sortbars.html"><a href="sortbars.html#factors"><i class="fa fa-check"></i><b>5.3.1</b> Staggered bars, and factors</a></li>
<li class="chapter" data-level="5.3.2" data-path="sortbars.html"><a href="sortbars.html#chart-facets-more-years-in-the-bar-chart"><i class="fa fa-check"></i><b>5.3.2</b> Chart facets, more years in the bar chart</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="sortbars.html"><a href="sortbars.html#whats-gone-wrong-4"><i class="fa fa-check"></i><b>5.4</b> What’s gone wrong?</a></li>
<li class="chapter" data-level="5.5" data-path="sortbars.html"><a href="sortbars.html#exercises-1"><i class="fa fa-check"></i><b>5.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="sortbars.html"><a href="sortbars.html#questions-3"><i class="fa fa-check"></i><b>5.5.1</b> Questions</a></li>
<li class="chapter" data-level="5.5.2" data-path="sortbars.html"><a href="sortbars.html#answers-3"><i class="fa fa-check"></i><b>5.5.2</b> Answers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="extended-exercises-emissions-graphs.html"><a href="extended-exercises-emissions-graphs.html"><i class="fa fa-check"></i><b>6</b> Extended Exercises - Emissions Graphs</a>
<ul>
<li class="chapter" data-level="6.1" data-path="extended-exercises-emissions-graphs.html"><a href="extended-exercises-emissions-graphs.html#questions-4"><i class="fa fa-check"></i><b>6.1</b> Questions</a></li>
<li class="chapter" data-level="6.2" data-path="extended-exercises-emissions-graphs.html"><a href="extended-exercises-emissions-graphs.html#co2hints"><i class="fa fa-check"></i><b>6.2</b> Hints</a></li>
<li class="chapter" data-level="6.3" data-path="extended-exercises-emissions-graphs.html"><a href="extended-exercises-emissions-graphs.html#answers-4"><i class="fa fa-check"></i><b>6.3</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="7" data-path="vectors-and-grouping-loops-of-a-sort.html"><a href="vectors-and-grouping-loops-of-a-sort.html"><i class="fa fa-check"></i><b>7</b> Vectors and grouping - Loops of a sort</a>
<ul>
<li class="chapter" data-level="7.1" data-path="vectors-and-grouping-loops-of-a-sort.html"><a href="vectors-and-grouping-loops-of-a-sort.html#vectors"><i class="fa fa-check"></i><b>7.1</b> Vectors</a></li>
<li class="chapter" data-level="7.2" data-path="vectors-and-grouping-loops-of-a-sort.html"><a href="vectors-and-grouping-loops-of-a-sort.html#exercises-2"><i class="fa fa-check"></i><b>7.2</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="vectors-and-grouping-loops-of-a-sort.html"><a href="vectors-and-grouping-loops-of-a-sort.html#questions-5"><i class="fa fa-check"></i><b>7.2.1</b> Questions</a></li>
<li class="chapter" data-level="7.2.2" data-path="vectors-and-grouping-loops-of-a-sort.html"><a href="vectors-and-grouping-loops-of-a-sort.html#answers-5"><i class="fa fa-check"></i><b>7.2.2</b> Answers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="splitparse.html"><a href="splitparse.html"><i class="fa fa-check"></i><b>8</b> NOTAMS: Splitting and parsing strings</a>
<ul>
<li class="chapter" data-level="8.1" data-path="splitparse.html"><a href="splitparse.html#splitting-a-column-into-many"><i class="fa fa-check"></i><b>8.1</b> Splitting a column into many</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="splitparse.html"><a href="splitparse.html#splitatcharacter"><i class="fa fa-check"></i><b>8.1.1</b> Splitting a column at a character</a></li>
<li class="chapter" data-level="8.1.2" data-path="splitparse.html"><a href="splitparse.html#splitting-a-column-at-a-regular-expression"><i class="fa fa-check"></i><b>8.1.2</b> Splitting a column at a regular expression</a></li>
<li class="chapter" data-level="8.1.3" data-path="splitparse.html"><a href="splitparse.html#splitting-a-column-at-an-either-or"><i class="fa fa-check"></i><b>8.1.3</b> Splitting a column at an either-or</a></li>
<li class="chapter" data-level="8.1.4" data-path="splitparse.html"><a href="splitparse.html#exercises-3"><i class="fa fa-check"></i><b>8.1.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="splitparse.html"><a href="splitparse.html#listcolumns"><i class="fa fa-check"></i><b>8.2</b> List columns</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="splitparse.html"><a href="splitparse.html#splitting-a-field-into-a-list"><i class="fa fa-check"></i><b>8.2.1</b> Splitting a field into a list</a></li>
<li class="chapter" data-level="8.2.2" data-path="splitparse.html"><a href="splitparse.html#more-realistic-splitting"><i class="fa fa-check"></i><b>8.2.2</b> More realistic splitting</a></li>
<li class="chapter" data-level="8.2.3" data-path="splitparse.html"><a href="splitparse.html#manipulate-fields-in-rows"><i class="fa fa-check"></i><b>8.2.3</b> Manipulate fields in rows</a></li>
<li class="chapter" data-level="8.2.4" data-path="splitparse.html"><a href="splitparse.html#exercises-4"><i class="fa fa-check"></i><b>8.2.4</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Analysing Flights with R - UNDER CONSTRUCTION</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="extended-exercises---emissions-graphs" class="section level1" number="6">
<h1><span class="header-section-number">Chapter 6</span> Extended Exercises - Emissions Graphs</h1>
<p>In chapters <a href="firstLook.html#firstLook">3</a> to <a href="sortbars.html#sortbars">5</a> we’ve covered some basics of the R language, seen through the process of building graphs of some emissions data. Before moving on to new concepts, you might like to try some extended exercises.</p>
<p>These do not introduce any new functions, but they might use new parameters for functions that you’ve already seen. So a good place to start if you’re stuck is the help file for the functions that you know about. If that doesn’t work, then there are some hints in chapter <a href="extended-exercises-emissions-graphs.html#co2hints">6.2</a>, deliberately placed slightly separate from the questions!</p>
<p>This book also has a search function, for finding your way back to relevant sections - see the magnifying glass top left. Up and down arrows move from one find to the next.</p>
<p>It’s good practice to periodically ‘clean’ your environment, that is, to remove all the data saved in it. This is essential before testing, because you often find that you’re relying on something that has been changed as you tweak and improve the code. Click the broom icon in the environment pane before you start the exercises.</p>
<div id="questions-4" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Questions</h2>
<ol style="list-style-type: decimal">
<li>Starting from the final graph in chapter <a href="filter.html#labelco2">4.5</a>, move the label to 2015 and set the colour of the label to black.</li>
<li>Building on (1) plot the 6 states with fewest flights in 2010, but which had more than 10,000 flights . There’s a bit of overlap, so use a different shape for each one.</li>
<li>(Harder) Plot the monthly emissions for France from 2015 onwards as a bar chart. We haven’t done dates yet, so use a character string.</li>
</ol>
</div>
<div id="co2hints" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Hints</h2>
<ol style="list-style-type: decimal">
<li>If you’re starting from a ‘clean’ environment, you will need to load the data and re-create <code>top_states</code>. Search in this book for <code>load(</code> and <code>top_states</code>.</li>
<li>Mostly a question of filtering. Don’t forget to check the text of your graph when it’s done. The help for <code>geom_point</code> lists which aesthetics are understood, so will help you find the parameter name for changing shape (in this case, it’s the obvious answer).</li>
<li>You need to go back to the code that loads the original excel file. You’ll need to <code>mutate</code> to create a new variable combining two strings <code>str_c</code> (or <code>paste</code>), but you need to put this inside an <code>if else</code> to treat 10-12 different to the other months, or the text won’t sort correctly. Remember what we did to the bar charts when there was long text on the x-axis?
In the end, it’s an ugly chart but let’s not worry too much about that.</li>
</ol>
</div>
<div id="answers-4" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Answers</h2>
<ol style="list-style-type: decimal">
<li>This exercise is really a lesson in assembling the code into one sequence - it gets a bit broken up in the book. You should probably include your <code>library(tidyverse)</code> statement at the top, for really complete code.</li>
</ol>
<p>Notice that we have two <code>colour</code> aesthetics: the default one which is by <code>YEAR</code> and one specifically for the <code>geom_text_repel</code>.</p>
<p>The other catch is that, because the colour of the text is constant, it appears outside the <code>aes()</code>, not inside.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="extended-exercises-emissions-graphs.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the dataset</span></span>
<span id="cb48-2"><a href="extended-exercises-emissions-graphs.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/annual_co2.rda&quot;</span>)</span>
<span id="cb48-3"><a href="extended-exercises-emissions-graphs.html#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="extended-exercises-emissions-graphs.html#cb48-4" aria-hidden="true" tabindex="-1"></a>top_states <span class="ot">&lt;-</span> annual_co2 <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="extended-exercises-emissions-graphs.html#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(YEAR <span class="sc">==</span> <span class="dv">2019</span>) <span class="sc">%&gt;%</span>     <span class="co"># top in year 2019</span></span>
<span id="cb48-6"><a href="extended-exercises-emissions-graphs.html#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(TF, <span class="at">n =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span>  <span class="co"># top 8 </span></span>
<span id="cb48-7"><a href="extended-exercises-emissions-graphs.html#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(STATE_NAME) </span>
<span id="cb48-8"><a href="extended-exercises-emissions-graphs.html#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="extended-exercises-emissions-graphs.html#cb48-9" aria-hidden="true" tabindex="-1"></a>annual_co2 <span class="ot">&lt;-</span> annual_co2 <span class="sc">%&gt;%</span> </span>
<span id="cb48-10"><a href="extended-exercises-emissions-graphs.html#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_label =</span> <span class="fu">if_else</span>(YEAR <span class="sc">==</span> <span class="dv">2015</span>, <span class="fu">str_to_title</span>(STATE_NAME), <span class="st">&quot;&quot;</span>))</span>
<span id="cb48-11"><a href="extended-exercises-emissions-graphs.html#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="extended-exercises-emissions-graphs.html#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(annual_co2 <span class="sc">%&gt;%</span> </span>
<span id="cb48-13"><a href="extended-exercises-emissions-graphs.html#cb48-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(STATE_NAME <span class="sc">%in%</span> top_states), </span>
<span id="cb48-14"><a href="extended-exercises-emissions-graphs.html#cb48-14" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(TF<span class="sc">/</span><span class="fl">1e6</span>, CO2_QTY_TONNES<span class="sc">/</span><span class="fl">1e6</span>, </span>
<span id="cb48-15"><a href="extended-exercises-emissions-graphs.html#cb48-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> YEAR, <span class="at">group =</span> STATE_NAME)) <span class="sc">+</span></span>
<span id="cb48-16"><a href="extended-exercises-emissions-graphs.html#cb48-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb48-17"><a href="extended-exercises-emissions-graphs.html#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>() <span class="sc">+</span></span>
<span id="cb48-18"><a href="extended-exercises-emissions-graphs.html#cb48-18" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> state_label), <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb48-19"><a href="extended-exercises-emissions-graphs.html#cb48-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_steps</span>(<span class="at">n.breaks =</span> <span class="dv">8</span>, <span class="at">show.limits =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb48-20"><a href="extended-exercises-emissions-graphs.html#cb48-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Departing Flights (millions)&quot;</span>, </span>
<span id="cb48-21"><a href="extended-exercises-emissions-graphs.html#cb48-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">bquote</span>(<span class="sc">~</span>CO[<span class="dv">2</span>]<span class="sc">~</span><span class="st">&quot; (million tonnes)&quot;</span>),</span>
<span id="cb48-22"><a href="extended-exercises-emissions-graphs.html#cb48-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb48-23"><a href="extended-exercises-emissions-graphs.html#cb48-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Emissions for the busiest 8 states&quot;</span>,</span>
<span id="cb48-24"><a href="extended-exercises-emissions-graphs.html#cb48-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Source: EUROCONTROL. &#39;Busiest&#39; means most flights in 2019.&quot;</span>)</span></code></pre></div>
<p><img src="flights_in_R_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>This is an exercise in logic in the <code>filter</code>. Did you remember to update the title, footnotes and the legend title?</li>
</ol>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="extended-exercises-emissions-graphs.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the dataset</span></span>
<span id="cb49-2"><a href="extended-exercises-emissions-graphs.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/annual_co2.rda&quot;</span>)</span>
<span id="cb49-3"><a href="extended-exercises-emissions-graphs.html#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="extended-exercises-emissions-graphs.html#cb49-4" aria-hidden="true" tabindex="-1"></a>selected_states <span class="ot">&lt;-</span> annual_co2 <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="extended-exercises-emissions-graphs.html#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(YEAR <span class="sc">==</span> <span class="dv">2010</span> <span class="sc">&amp;</span> TF <span class="sc">&gt;</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span>     <span class="co"># more than 10k flights</span></span>
<span id="cb49-6"><a href="extended-exercises-emissions-graphs.html#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(TF, <span class="at">n =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span>  <span class="co"># bottom 6 </span></span>
<span id="cb49-7"><a href="extended-exercises-emissions-graphs.html#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(STATE_NAME) </span>
<span id="cb49-8"><a href="extended-exercises-emissions-graphs.html#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="extended-exercises-emissions-graphs.html#cb49-9" aria-hidden="true" tabindex="-1"></a>annual_co2 <span class="ot">&lt;-</span> annual_co2 <span class="sc">%&gt;%</span> </span>
<span id="cb49-10"><a href="extended-exercises-emissions-graphs.html#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_label =</span> <span class="fu">if_else</span>(YEAR <span class="sc">==</span> <span class="dv">2015</span>, <span class="fu">str_to_title</span>(STATE_NAME), <span class="st">&quot;&quot;</span>))</span>
<span id="cb49-11"><a href="extended-exercises-emissions-graphs.html#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="extended-exercises-emissions-graphs.html#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(annual_co2 <span class="sc">%&gt;%</span> </span>
<span id="cb49-13"><a href="extended-exercises-emissions-graphs.html#cb49-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(STATE_NAME <span class="sc">%in%</span> selected_states), </span>
<span id="cb49-14"><a href="extended-exercises-emissions-graphs.html#cb49-14" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(TF<span class="sc">/</span><span class="fl">1e6</span>, CO2_QTY_TONNES<span class="sc">/</span><span class="fl">1e6</span>, </span>
<span id="cb49-15"><a href="extended-exercises-emissions-graphs.html#cb49-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> YEAR, <span class="at">group =</span> STATE_NAME)) <span class="sc">+</span></span>
<span id="cb49-16"><a href="extended-exercises-emissions-graphs.html#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> STATE_NAME)) <span class="sc">+</span> </span>
<span id="cb49-17"><a href="extended-exercises-emissions-graphs.html#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>() <span class="sc">+</span></span>
<span id="cb49-18"><a href="extended-exercises-emissions-graphs.html#cb49-18" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> state_label), <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb49-19"><a href="extended-exercises-emissions-graphs.html#cb49-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_steps</span>(<span class="at">n.breaks =</span> <span class="dv">8</span>, <span class="at">show.limits =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb49-20"><a href="extended-exercises-emissions-graphs.html#cb49-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Departing Flights (millions)&quot;</span>, </span>
<span id="cb49-21"><a href="extended-exercises-emissions-graphs.html#cb49-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">bquote</span>(<span class="sc">~</span>CO[<span class="dv">2</span>]<span class="sc">~</span><span class="st">&quot; (million tonnes)&quot;</span>),</span>
<span id="cb49-22"><a href="extended-exercises-emissions-graphs.html#cb49-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb49-23"><a href="extended-exercises-emissions-graphs.html#cb49-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">shape =</span> <span class="st">&quot;State&quot;</span>,</span>
<span id="cb49-24"><a href="extended-exercises-emissions-graphs.html#cb49-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Emissions for the least-busy 6 states&quot;</span>,</span>
<span id="cb49-25"><a href="extended-exercises-emissions-graphs.html#cb49-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Source: EUROCONTROL. &#39;Least-busy&#39; means fewest flights in 2010, but more than 10k flights.&quot;</span>)</span></code></pre></div>
<p><img src="flights_in_R_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>You could load from Excel and immediately filter. I do it in two steps, because then I can check the correct field names for the <code>filter</code> and <code>mutate</code> using the environment pane.</li>
</ol>
<p>This is an exercise in building up quite complex statements from simple functions. Formatting with line breaks should help a lot.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="extended-exercises-emissions-graphs.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># go back to the excel file</span></span>
<span id="cb50-2"><a href="extended-exercises-emissions-graphs.html#cb50-2" aria-hidden="true" tabindex="-1"></a>aviation_co2 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">&quot;data/CO2_emissions.xlsx&quot;</span>, </span>
<span id="cb50-3"><a href="extended-exercises-emissions-graphs.html#cb50-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sheet =</span> <span class="st">&quot;DATA&quot;</span>)</span>
<span id="cb50-4"><a href="extended-exercises-emissions-graphs.html#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># just the data that we need</span></span>
<span id="cb50-5"><a href="extended-exercises-emissions-graphs.html#cb50-5" aria-hidden="true" tabindex="-1"></a>monthly_co2 <span class="ot">&lt;-</span> aviation_co2 <span class="sc">%&gt;%</span> </span>
<span id="cb50-6"><a href="extended-exercises-emissions-graphs.html#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(YEAR <span class="sc">&gt;=</span> <span class="dv">2017</span> <span class="sc">&amp;</span> STATE_NAME <span class="sc">==</span> <span class="st">&quot;FRANCE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-7"><a href="extended-exercises-emissions-graphs.html#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">if_else</span>(MONTH <span class="sc">&lt;</span> <span class="dv">10</span>,</span>
<span id="cb50-8"><a href="extended-exercises-emissions-graphs.html#cb50-8" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">str_c</span>(YEAR, <span class="st">&quot;  &quot;</span>, MONTH), </span>
<span id="cb50-9"><a href="extended-exercises-emissions-graphs.html#cb50-9" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">str_c</span>(YEAR, <span class="st">&quot; &quot;</span>, MONTH))) <span class="co">#a pseudo-date</span></span>
<span id="cb50-10"><a href="extended-exercises-emissions-graphs.html#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="extended-exercises-emissions-graphs.html#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># then the basic ggplot(data, aes(x,y)) + geometry...</span></span>
<span id="cb50-12"><a href="extended-exercises-emissions-graphs.html#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthly_co2, <span class="fu">aes</span>(date, CO2_QTY_TONNES<span class="sc">/</span><span class="fl">1e6</span>)) <span class="sc">+</span></span>
<span id="cb50-13"><a href="extended-exercises-emissions-graphs.html#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb50-14"><a href="extended-exercises-emissions-graphs.html#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb50-15"><a href="extended-exercises-emissions-graphs.html#cb50-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">bquote</span>(<span class="sc">~</span>CO[<span class="dv">2</span>]<span class="sc">~</span><span class="st">&quot; (million tonnes)&quot;</span>),</span>
<span id="cb50-16"><a href="extended-exercises-emissions-graphs.html#cb50-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Aviation Emissions of France&quot;</span>,</span>
<span id="cb50-17"><a href="extended-exercises-emissions-graphs.html#cb50-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Source: EUROCONTROL.&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-18"><a href="extended-exercises-emissions-graphs.html#cb50-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="flights_in_R_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sortbars.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["flights_in_R.pdf", "flights_in_R.epub"],
"toc": {
"collapse": "subsection"
},
"theme": "sepia"
});
});
</script>

</body>

</html>
