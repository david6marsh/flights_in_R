<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Sorting Bars, Saving Graphs, Vectors and Loops | Analysing Flights with R</title>
  <meta name="description" content="This is a training and reference manual for Eurocontrol staff, on how to use RStudio to analyse our traffic data." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Sorting Bars, Saving Graphs, Vectors and Loops | Analysing Flights with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a training and reference manual for Eurocontrol staff, on how to use RStudio to analyse our traffic data." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Sorting Bars, Saving Graphs, Vectors and Loops | Analysing Flights with R" />
  
  <meta name="twitter:description" content="This is a training and reference manual for Eurocontrol staff, on how to use RStudio to analyse our traffic data." />
  

<meta name="author" content="David Marsh" />


<meta name="date" content="2021-01-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="filtering-a-dataset-and-refining-the-co2-graph.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Analysing Flights in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> How to use this book</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#before-you-start"><i class="fa fa-check"></i><b>1.1</b> Before you start</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#ways-to-use-the-material"><i class="fa fa-check"></i><b>1.2</b> Ways to Use the Material</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#whats-gone-wrong"><i class="fa fa-check"></i><b>1.3</b> What’s gone wrong?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="start.html"><a href="start.html"><i class="fa fa-check"></i><b>2</b> Getting started</a>
<ul>
<li class="chapter" data-level="2.1" data-path="start.html"><a href="start.html#rstudio"><i class="fa fa-check"></i><b>2.1</b> Orientation in RStudio</a></li>
<li class="chapter" data-level="2.2" data-path="start.html"><a href="start.html#first-project"><i class="fa fa-check"></i><b>2.2</b> First project</a></li>
<li class="chapter" data-level="2.3" data-path="start.html"><a href="start.html#first-code"><i class="fa fa-check"></i><b>2.3</b> First code</a></li>
<li class="chapter" data-level="2.4" data-path="start.html"><a href="start.html#packages"><i class="fa fa-check"></i><b>2.4</b> First packages</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="start.html"><a href="start.html#package-basics"><i class="fa fa-check"></i><b>2.4.1</b> Package basics</a></li>
<li class="chapter" data-level="2.4.2" data-path="start.html"><a href="start.html#tidyverse"><i class="fa fa-check"></i><b>2.4.2</b> Tidyverse</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="start.html"><a href="start.html#filetypes"><i class="fa fa-check"></i><b>2.5</b> File types</a></li>
<li class="chapter" data-level="2.6" data-path="start.html"><a href="start.html#whats-gone-wrong-1"><i class="fa fa-check"></i><b>2.6</b> What’s gone wrong?</a></li>
<li class="chapter" data-level="2.7" data-path="start.html"><a href="start.html#test-yourself"><i class="fa fa-check"></i><b>2.7</b> Test yourself</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="start.html"><a href="start.html#questions"><i class="fa fa-check"></i><b>2.7.1</b> Questions</a></li>
<li class="chapter" data-level="2.7.2" data-path="start.html"><a href="start.html#answers"><i class="fa fa-check"></i><b>2.7.2</b> Answers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html"><i class="fa fa-check"></i><b>3</b> First look at data and CO<sub>2</sub> Emissions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#loadco2"><i class="fa fa-check"></i><b>3.1</b> Looking at data: CO<sub>2</sub> Data</a></li>
<li class="chapter" data-level="3.2" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#extracting-variables"><i class="fa fa-check"></i><b>3.2</b> Extracting variables</a></li>
<li class="chapter" data-level="3.3" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#extracting-a-few-values"><i class="fa fa-check"></i><b>3.3</b> Extracting a few values</a></li>
<li class="chapter" data-level="3.4" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#co2-scatter-plot"><i class="fa fa-check"></i><b>3.4</b> CO<sub>2</sub> Scatter plot</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#first-draft"><i class="fa fa-check"></i><b>3.4.1</b> First draft</a></li>
<li class="chapter" data-level="3.4.2" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#improve-the-titles"><i class="fa fa-check"></i><b>3.4.2</b> Improve the titles</a></li>
<li class="chapter" data-level="3.4.3" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#statecluster"><i class="fa fa-check"></i><b>3.4.3</b> and with clustering by State</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#whats-gone-wrong-2"><i class="fa fa-check"></i><b>3.5</b> What’s gone wrong?</a></li>
<li class="chapter" data-level="3.6" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#test-yourself-1"><i class="fa fa-check"></i><b>3.6</b> Test yourself</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#questions-1"><i class="fa fa-check"></i><b>3.6.1</b> Questions</a></li>
<li class="chapter" data-level="3.6.2" data-path="first-look-at-data-and-co2-emissions.html"><a href="first-look-at-data-and-co2-emissions.html#answers-1"><i class="fa fa-check"></i><b>3.6.2</b> Answers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html"><i class="fa fa-check"></i><b>4</b> Filtering a dataset and refining the CO<sub>2</sub> graph</a>
<ul>
<li class="chapter" data-level="4.1" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#sequences-of-functions"><i class="fa fa-check"></i><b>4.1</b> Sequences of functions</a></li>
<li class="chapter" data-level="4.2" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#filtering-datasets-and-logical-tests"><i class="fa fa-check"></i><b>4.2</b> Filtering datasets and Logical Tests</a></li>
<li class="chapter" data-level="4.3" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#selecting-the-busiest-states"><i class="fa fa-check"></i><b>4.3</b> Selecting the busiest States</a></li>
<li class="chapter" data-level="4.4" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#co2-graph-for-the-top-states"><i class="fa fa-check"></i><b>4.4</b> CO<sub>2</sub> graph for the top States</a></li>
<li class="chapter" data-level="4.5" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#labelling-the-co2-graph"><i class="fa fa-check"></i><b>4.5</b> Labelling the CO<sub>2</sub> graph</a></li>
<li class="chapter" data-level="4.6" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#what-does-the-graph-say-about-co2"><i class="fa fa-check"></i><b>4.6</b> What does the graph say about CO<sub>2</sub>?</a></li>
<li class="chapter" data-level="4.7" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#whats-gone-wrong-3"><i class="fa fa-check"></i><b>4.7</b> What’s gone wrong?</a></li>
<li class="chapter" data-level="4.8" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#exercises"><i class="fa fa-check"></i><b>4.8</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#questions-2"><i class="fa fa-check"></i><b>4.8.1</b> Questions</a></li>
<li class="chapter" data-level="4.8.2" data-path="filtering-a-dataset-and-refining-the-co2-graph.html"><a href="filtering-a-dataset-and-refining-the-co2-graph.html#answers-2"><i class="fa fa-check"></i><b>4.8.2</b> Answers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sorting-bars-saving-graphs-vectors-and-loops.html"><a href="sorting-bars-saving-graphs-vectors-and-loops.html"><i class="fa fa-check"></i><b>5</b> Sorting Bars, Saving Graphs, Vectors and Loops</a>
<ul>
<li class="chapter" data-level="5.1" data-path="sorting-bars-saving-graphs-vectors-and-loops.html"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#co2-bar-chart"><i class="fa fa-check"></i><b>5.1</b> CO<sub>2</sub> bar chart</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="sorting-bars-saving-graphs-vectors-and-loops.html"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#firstsortedbar"><i class="fa fa-check"></i><b>5.1.1</b> The simple sorted bar chart</a></li>
<li class="chapter" data-level="5.1.2" data-path="sorting-bars-saving-graphs-vectors-and-loops.html"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#saving-a-plot"><i class="fa fa-check"></i><b>5.1.2</b> Saving a plot</a></li>
<li class="chapter" data-level="5.1.3" data-path="sorting-bars-saving-graphs-vectors-and-loops.html"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#plotting-more-than-one-year"><i class="fa fa-check"></i><b>5.1.3</b> Plotting more than one year</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="sorting-bars-saving-graphs-vectors-and-loops.html"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#exercises-1"><i class="fa fa-check"></i><b>5.2</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="sorting-bars-saving-graphs-vectors-and-loops.html"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#questions-3"><i class="fa fa-check"></i><b>5.2.1</b> Questions</a></li>
<li class="chapter" data-level="5.2.2" data-path="sorting-bars-saving-graphs-vectors-and-loops.html"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#answers-3"><i class="fa fa-check"></i><b>5.2.2</b> Answers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Analysing Flights with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sorting-bars-saving-graphs-vectors-and-loops" class="section level1" number="5">
<h1><span class="header-section-number">Chapter 5</span> Sorting Bars, Saving Graphs, Vectors and Loops</h1>
<p>While nothing beats a well hand-crafted chart, there are times when you want to just run the code and get a quick update, as a .png say. , probably multiple graphs covering different</p>
<p>In this chapter we see how to do a classic sorted-bar chart and to save it to a file for future use.</p>
<table>
<colgroup>
<col width="100%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">In this chapter</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>geom_col()</code>, <code>reorder()</code>, <code>ggsave()</code>, <code>coord_flip()</code>, <code>slice_max()</code>, <code>%&gt;%</code>, <code>geom_text_repel()</code></td>
</tr>
</tbody>
</table>
<div id="co2-bar-chart" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> CO<sub>2</sub> bar chart</h2>
<div id="firstsortedbar" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> The simple sorted bar chart</h3>
<p>A classic visualisation is the bar chart, sorted from longest to shortest. With <code>ggplot</code> there are a couple of ways to get a bar chart. If you want <code>ggplot</code> to count the rows for you, use <code>geom_bar</code>. Here we already have values for the length of the bar, so we use <code>geom_col</code> instead.</p>
<p>For the simplest bar charts, there is a quick way to get the order you want. In place of <code>state_label</code> for the x-axis, you give <code>reorder(state_label, Y_CO2_QTY_TONNES)</code>, the second being the variable to sort by. If you find the bars a bit top-heavy, put a <code>-</code> in front to reverse the order.</p>
<p>The final novelty in this graph is <code>coord_flip()</code>. Forty-something State names is a lot of text to cram onto the horizontal axis. So we flip the axes. You’ll need to decide if this trick works where you want to use the graph. We’ll see other ways to separate the labels on the axes in (TBD).</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(aviation_co2 <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb34-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(YEAR <span class="sc">==</span> <span class="dv">2019</span>), </span>
<span id="cb34-3"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb34-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="fu">reorder</span>(state_label, Y_CO2_QTY_TONNES),</span>
<span id="cb34-4"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb34-4" aria-hidden="true" tabindex="-1"></a>           Y_CO2_QTY_TONNES<span class="sc">/</span><span class="fl">1e6</span>)) <span class="sc">+</span></span>
<span id="cb34-5"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb34-6"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb34-7"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb34-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">bquote</span>(<span class="sc">~</span>CO[<span class="dv">2</span>]<span class="sc">~</span><span class="st">&quot; (million tonnes)&quot;</span>),</span>
<span id="cb34-8"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb34-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Aviation Emissions in 2019&quot;</span>,</span>
<span id="cb34-9"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb34-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Source: EUROCONTROL.&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-10"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="flights_in_R_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<p>If you were to google ‘ggplot ordered bar chart,’ you might find references to ‘factors.’ That becomes necessary when the charts are more complicated. We’ll look at that in section (TBD)</p>
</div>
<div id="saving-a-plot" class="section level3" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Saving a plot</h3>
<p>You might be looking at the bar chart and thinking that it’s the wrong proportions for your need (portrait rather than landscape, or vice versa) or you might be thinking the axis labels are still a bit squashed together.</p>
<p>The proportions on your screen will depend on a number of things including the space you have allowed for the ‘Plots’ window. Now, the plots window has an export button which you could use. It allows for re-sizing, but that means you have to do the same manual intervention each time.</p>
<p>We can instead use <code>ggsave()</code> to save the most-recent plot, and at the same time set the aspect ratio that we need. Usually it’s worth doing this before working too much on the font sizes, since you don’t really know if there’s a problem until you’ve seen the png.</p>
<p>Finally, we use the <code>graphs</code> folder we created for the project. Square seems about right for this graph; and having one of the dimensions around 15cm also seems to produce png that are good enough for reports and slides without being too big.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;graphs/FirstSortedBars.png&quot;</span>, <span class="at">width =</span> <span class="dv">15</span>, <span class="at">height =</span> <span class="dv">15</span>, <span class="at">units =</span> <span class="st">&quot;cm&quot;</span>)</span></code></pre></div>
</div>
<div id="plotting-more-than-one-year" class="section level3" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Plotting more than one year</h3>
<p>I can think of four ways to plot more than one year:</p>
<ol style="list-style-type: decimal">
<li>as staggered bars, though we probably will have to work hard to make enough space;</li>
<li>as ‘facets,’ creating one sub-plot per year;</li>
<li>as a few graphs, merged and aligned using an dedicated package like <code>cowplot</code>;</li>
<li>as multiple graphs using a loop</li>
</ol>
<p>Number (3) is a bit heavy. It’s particularly useful for combining graphs of different variables. We’ll deal with (4) in section (TBD) when we look at loops. The first two we will do in the next sections.</p>
<div id="staggered-bars-and-factors" class="section level4" number="5.1.3.1">
<h4><span class="header-section-number">5.1.3.1</span> Staggered bars, and factors</h4>
<p>We took some shortcuts in @ref{firstsortedbar}, which will need sorting out for the staggered bars. First we need to choose a couple of years, since there certainly isn’t room for more than two. We used <code>state_label</code> before, but this only exists for 2019, so we have to go back to using <code>STATE_NAME</code>. It’s probably time to make this name title case once and for all.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb36-1" aria-hidden="true" tabindex="-1"></a>aviation_co2 <span class="ot">&lt;-</span> aviation_co2 <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">STATE_NAME =</span> <span class="fu">str_to_title</span>(STATE_NAME))</span>
<span id="cb36-3"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(aviation_co2 <span class="sc">%&gt;%</span> </span>
<span id="cb36-5"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb36-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(YEAR <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2010</span>, <span class="dv">2019</span>)), </span>
<span id="cb36-6"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb36-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="fu">reorder</span>(STATE_NAME, Y_CO2_QTY_TONNES),</span>
<span id="cb36-7"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb36-7" aria-hidden="true" tabindex="-1"></a>           Y_CO2_QTY_TONNES<span class="sc">/</span><span class="fl">1e6</span>,</span>
<span id="cb36-8"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb36-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="fu">as_factor</span>(YEAR))) <span class="sc">+</span></span>
<span id="cb36-9"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb36-10"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb36-11"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb36-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">bquote</span>(<span class="sc">~</span>CO[<span class="dv">2</span>]<span class="sc">~</span><span class="st">&quot; (million tonnes)&quot;</span>),</span>
<span id="cb36-12"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb36-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Aviation Emissions in 2019&quot;</span>,</span>
<span id="cb36-13"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb36-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Source: EUROCONTROL.&quot;</span>,</span>
<span id="cb36-14"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb36-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Year&quot;</span>) <span class="sc">+</span></span>
<span id="cb36-15"><a href="sorting-bars-saving-graphs-vectors-and-loops.html#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="flights_in_R_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="exercises-1" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Exercises</h2>
<div id="questions-3" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Questions</h3>
<ul>
<li>Plot the bar chart of section @ref{firstsortedbard} with the longest bars at the bottom.</li>
<li>Plot the bar chart of section @ref{firstsortedbard} without the 3 near-zero entries. (Hints: View the data. Filter on 2019 and choose a threshold.)</li>
<li>Read the description of <code>geom_bar</code> in the help file. In the first bar chart, switch to using <code>geom_bar</code> instead. [Hint: A minor addition to the <code>aes()</code>.]</li>
</ul>
</div>
<div id="answers-3" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Answers</h3>
<ul>
<li>Use reorder(state_label, -Y_CO2_QTY_TONNES).</li>
<li>Use <code>filter(YEAR == 2019 &amp; Y_CO2_QTY_TONNES &gt; 100000)</code>.</li>
<li>Replace <code>geom_col</code> with <code>geom_bar</code> and add <code>weight =</code> in front of <code>Y_CO2_QTY_TONNES/1e6</code>, thus switching it from the <code>y</code> parameter to the <code>weight</code>.</li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="filtering-a-dataset-and-refining-the-co2-graph.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["flights_in_R.pdf", "flights_in_R.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
